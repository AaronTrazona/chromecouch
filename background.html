<script src="assets/jquery.min.js"></script>
<script>

  // function parseResponse(err, resp, body) {
  //   if (err) {
  //     msg = {"error" : "http_error", "reason": err.message}
  //   } else if (body) {
  //     msg = JSON.parse(body);
  //   } else if (resp) {
  //     msg = JSON.parse(resp);
  //   }
  //   return msg;
  // }
  // 
  // function createDb(db, couch, callback) {
  //   request({method: "GET", uri:couch + "/" + db, headers:headers}, function(err, resp, body) {
  //     var msg = parseResponse(err, resp, body);
  //     if (msg.error && msg.reason === "no_db_file") {
  //       request({method: "PUT", uri:couch + "/" + db, headers:headers}, function(err, resp, body) {
  //          msg = parseResponse(err, resp, body);
  //          callback(msg);
  //        });
  //     } else {
  //       callback(msg);
  //     }
  //   });
  // }
  // 
  // function ensureParams(params, req) {
  //   var missing = false;
  //   params.forEach(function(param) {
  //     if ( req.body[param] === "" ) {
  //       missing = {"error" : "missing_params", "reason": "Missing parameters. Please fill out the required fields"};
  //     }
  //   })
  //   return missing;
  // }
  // 
  // app.post("/provision", function(req, res) {
  //   var missing = ensureParams(['username', 'password', 'url'], req);
  //   if (missing) {
  //     res.send(missing);
  //   } else {
  //     var couch = "http://" + req.body.username + ":" + req.body.password + "@" + req.body.url;
  //     var target = "monocles";
  //     createDb(target, couch, 
  //       function (msg) {
  //         if (msg.error) {
  //           res.send(msg);
  //         } else if (msg.db_name || msg.ok) {
  //           replicateMonocles(couch, target, 
  //             function (err, resp, body) {
  //               res.send(parseResponse(err, resp, body));
  //               // TODO PUT http://admin:password@couch:5984/_config/vhosts/domainname -d '"/monocles/_design/couchappspora/_rewrite"'
  //             }
  //           )
  //         }
  //       }
  //     )
  //   }
  // });

  function onRequest(request, sender, callback) {
    if (request.action == 'getJSON') {
      $.getJSON(request.url, callback);
    }
  }

  chrome.extension.onRequest.addListener(onRequest);
</script>